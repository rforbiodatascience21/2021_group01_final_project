---
title: "Presentation of heart data project"
author: "Laura Hjort Blicher, Rolf Glenny Mogensen, Malte Birk, Tenna Pedersen"
date: "11_05_2021"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
library(tidyverse)
```

## Introduction
<font size = "3">Data was pulled on 27. April 2021 and is available at: https://archive.ics.uci.edu/ml/datasets/Heart+Disease?fbclid=IwAR3SbR6Eo3ow8dYal4mTv321XOUAUg8yw5g_WY-eDz9hUQS_0jJ0-qTR9v8 

Created in 1988 by:

- Hungarian Institute of Cardiology. Budapest: Andras Janosi, M.D.

- University Hospital, Zurich, Switzerland: William Steinbrunn, M.D.

- University Hospital, Basel, Switzerland: Matthias Pfisterer, M.D.

- V.A. Medical Center, Long Beach and Cleveland Clinic Foundation: Robert Detrano, M.D., Ph.D.

- Contains information of heart patients from 4 locations: 
Cleveland, Hungary, Switzerland and Long Beach. </font>

<font size = "4">Goal of study</font>

- <font size = "3">Perform visual analysis of data distribution
- Try to predict if patients have heart disease or not according to features in the dataset (PCA, K-means, Binomial regression)
</font>

## Materials and methods: Data processing
<font size = "5">
`-`  Data processing, modeling and creation of presentation was performed in Rstudio Cloud.

`-`  Way of coding follows O'Reillys R for Data Science by Wickham and Grolemund 

`-`  Data wrangling was achieved through _piping_ (`%>%`) 

`-`  Whole project exists at github at: 
https://github.com/rforbiodatascience21/2021_group01_final_project
</font>

## Project outline 
- <font size = "4">Loading and cleaning data</font>
  - <font size = "4">Add location variable 
  - Join data sets</font> 
- <font size = "4">Augmentation of data
  - Create categorical variables</font> 
- <font size = "4">Analysis and Visualisations
  - Distribution of presence of heart disease across physiological variables.</font>
- <font size = "4">Unsupervised analysis</font>
  - <font size = "4">PCA
  - K-means clustering</font>
- <font size = "4">Supervised classification model
  - Binomial regression</font>

## Data wrangling and cleaning 
### Data Import
- <font size = "4">Modified version of data sets was used</font>
- <font size = "4">Identifiers for the variables was not released for raw data </font>
- <font size = "4">14/76 attributes was used</font>
- <font size = "4">The Cleveland database is the only one that has been used by ML researchers to this date</font>
- <font size = "4">Example of snippet raw data collected from Cleveland </font>

```{r, echo = FALSE, warning = FALSE, message = FALSE}
data_raw <- read_csv("../data/_raw/processed.cleveland.data")
head(data_raw, 4) %>% select(1:9)
```
## All included variables
1. The age of the participates in the study in years    

2. The gender of the  participates

    * 0 = female

    * 1 = male

3. The type of chest pain

    * 1 = typical angina

    * 2 = atypical angina

    * 3 = non-anginal pain

    * 4 = asymptomatic

4. The resting blood pressure in mm Hg on admission to the hospital  

5. The serum cholestoral in $\frac{mg}{dl}$    

6. The fasting blood sugar

    * 0 = fasting blood sugar $< 120 \frac{mg}{dl}$

    * 1 = fasting blood sugar $> 120 \frac{mg}{dl}$

7. The result of the resting electrocardiographic

    * 0 = normal

    * 1 = ST  and/or T wave abnormality

    * 2 = showing probable or definite left ventricular hypertrophy

8. The maximum heart rate achieved   

9. Exercise induced angina

    * 1 = yes

    * 0 = no

10. ST depression induced by exercise relative to resting stage   

11. The slope of the peak exercise ST segment

    * 1 = upsloping

    * 2 = flat

    * 3 = downsloping

12. The number of major vessels colored by flourosopy

    * $0\leq Major\ vessels\leq 3$

13. The defect type of thalassemia

    * 3 = normal

    * 6 = fixed defect

    * 7 = reversable defect

14. The diagnosis of heart disease

    * 0 = no heart disease present

    * [1;4] = types of heart disease 

## Data Cleaning 
- <font size = "4"> Joined together the 4 data frames - Handling of missing values </font>
![](/cloud/project/results/04_NA_Bar.png){width=100%}

## Tidying and wrangling data
<font size = "4">Data was augmented by creating new more insightful columns</font>

- <font size = "4">Created categorical age groups for patients, location, diagnosis of disease, sex, chest pain type, fasting blood sugar,  resting electrocardiographic, exercise induced angina, slope of ST and thal</font>

![](/cloud/project/results/non_R_generated_figures/Flowchart_R_presentation.png){width=100%}

## Descriptive data analysis and visualisations
- <font size = "4">Distribution according to disease presence</font>
- <font size = "4">General thoughts for data composition</font>
- <font size = "4">Data seems balanced, disease present 46,5%, not present 53,5%</font>

```{r, echo = FALSE}
load("/cloud/project/results/04_Summary_table.RData")
kable(Summary_table,format = "html", digits = 3)%>%
  kable_styling(font_size = 12)%>%
  column_spec(1:4,width = "1.5cm")%>%
  column_spec(4, width = "2cm")
```
## Descriptive data analysis and visualisations
![](/cloud/project/results/04_Summary_density_plots.png){width=100%}

## Descriptive data analysis and visualisations
```{r, echo = FALSE}
#- <font size = "4">Distribution according to disease presence
#- First hand biological insights 
#- continous plot</font>
```
![](/cloud/project/results/04_Summary_bar_plots.png){width=100%}

## Unsupervised learning: Results from PCA 
- Data wrangling and handling of NAs 
- Regions in which the majority of the pool of observations show consistency in presence/absence of disease
- The first three PCs account for ~70% of the total variance
- Indicating that we should be able to separate observations with presence of disease from absence of disease 

## Unsupervised learning: Results from PCA 
![](/cloud/project/results/08_pca_combined.png){width=100%} 

## Unsupervised learning: Kmeans Cluster
- Handling of NA and selection of data 
- Performed on PCA data for K = 2   
![](/cloud/project/results/08_kmeans.png){width=100%}

## Unsupervised learning: Kmeans Cluster
- Classifies ~ 75% is correctly "classified"


```{r, echo=FALSE}
load("/cloud/project/results/08_Matrix_conf.RData")
Matrix_conf21 <- Matrix_conf2 %>%
  select(`True Positive`,`False Positive`,`False Negative`,`True Negative`)
Matrix2 <- Matrix_conf2 %>%
  select(accuracy,Precision,Recall,F_score)

kable(Matrix_conf21,format = "html", digits = 3)%>%
  kable_styling(font_size = 14)
kable(Matrix2,format = "html", digits = 3)%>%
  kable_styling(font_size = 14)

```


## Supervised learning: Prediction model based on presence of heart disease 
- <font size = "4">Two binomial regression was created:</font>
  - <font size = "4">The first binomial Regression model predicts the odds of being diagnosed with a heart disease, given the participants age</font>
  - <font size = "4">The first binomial Regression model predicts the odds of being diagnosed with a heart disease, given the participants age, gender and type of chest pain</font>
```{r, echo=FALSE}
load("/cloud/project/results/05_Matrix_conf.RData")
Matrix_conf1 <- Matrix_conf %>%
  select(Model_formular,`True Positive`,`False Positive`,`False Negative`,`True Negative`)
Matrix <- Matrix_conf %>%
  select(Model_formular,accuracy,Precision,Recall,F_score)

kable(Matrix_conf1,format = "html", digits = 3)%>%
  kable_styling(font_size = 14)
```

## Confusion matrix
- <font size = "4"> Based on the result of from the confusion matrix, it intuitively seems that the second is the better predictor model</font>
- <font size = "4">This is further illustrated by the result of the in the second table:</font>
- <font size = "4"> As can be seen in the table the accuracy, precision, recall and F score is higher for the second model, which means the second model is the better model</font>
```{r, echo=FALSE}
kable(Matrix,format = "html", digits = 3)%>%
  kable_styling(font_size = 14)
```
## Discussion
### Considerations concerning the data used
- <font size = "4">Use of all 4 databases vs. use of Cleveland_data only </font> 
- <font size = "4">Missing information as a result of removing rows containing NA</font>
- <font size = "4">Old data sets might have some medical measurements that 
could be irrelevant and outdated for prediction today</font>

### Biological insights 
- <font size = "4">Which variables contribute to prediction.</font>
- <font size = "4">Binomial regression: 20% to 30% of the patients will be wrongly classified.</font> 
- <font size = "4">K-means: 25% of the patients will be wrongly classified.</font>
- <font size = "4">Results of models indicate that it is possible to predict presence of heart disease, however none of the models used are good enough for medical usage.</font> 

## Thank you
### Questions?